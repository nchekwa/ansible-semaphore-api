name: Check version

on:
  #schedule:
  #  - cron: '*/5 * * * *'
  push:
    branches:
      - main
    paths:
      - '.github/workflows/check-version.yml'
      
jobs:
  tag:
    name: Tag
    runs-on: ubuntu-latest
    steps:
      - name: Get current date
        id: date
        run: echo "::set-output name=date::$(date +'%Y-%m-%d')"
      - name: Checkout branch "master"
        uses: actions/checkout@v4
      - name: "Call API"
        uses: indiesdev/curl@v1.1
        id: api
        with:
          url: https://api.github.com/repos/ansible-semaphore/semaphore/releases/latest
          method: "GET"
          log-response: true
      
      - name: Extract version from API response
        run: |
          echo "Latest release response: ${{ steps.api.outputs.response }}"
          version=$(echo "${{ steps.api.outputs.response }}" | jq -r '.tag_name' | sed 's/^v//')
          echo "Extracted version: $version"
        shell: bash
